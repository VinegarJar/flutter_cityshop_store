# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane
##åœ¨é¡¹ç›®æ–‡ä»¶androidç›®å½•ä¸‹æ‰§è¡Œå‘½ä»¤fastlane uploadFirç”ŸæˆIPAæ–‡ä»¶,å¹¶ä¸”ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ°Fir,å‘é€åˆ°é’‰é’‰ç¾¤é€šçŸ¥
#ä½¿ç”¨flutteræ‰“åŒ…å‘½ä»¤ flutter build apk
# å®‰è£…æ’ä»¶fastlane add_plugin fir_cli  fastlane add_plugin ding_talk_msg_push
# ä¸‹è½½é“¾æ¥http://d.7short.com/5a1s https://oapi.dingtalk.com/robot/send?access_token=3a01c05738abaaeaf5c5e17d80d4cc5870410387126c5a5e2fbf0095a79977ef
# æ›´å¿«çš„å¯åŠ¨é€Ÿåº¦æ‰§è¡Œæ‰“åŒ…å‘½ä»¤bundle exec fastlane uploadFir 
#å‘½ä»¤ä¸€ã€flutter build apk --release
#å‘½ä»¤äºŒã€flutter build apk --target-platform android-arm64(æ‰“åŒ…å‡ºçš„å®‰è£…åŒ…(apk)å®‰è£…åé—ªé€€ï¼Œé‚£è¯·ä½¿ç”¨å‘½ä»¤äºŒæ‰“åŒ…)

default_platform(:android)

platform :android do
  desc "Firæµ‹è¯•ç‰ˆæœ¬apk"
  lane :uploadFir do
    gradle(task: "clean assembleRelease")
    fir_cli api_token:"d2f653948d859d2f06f88eb4d1d39e8f", specify_file_path:"../build/app/outputs/flutter-apk/app-release.apk",need_release_id:true,dingtalk_access_token:"3a01c05738abaaeaf5c5e17d80d4cc5870410387126c5a5e2fbf0095a79977ef",dingtalk_custom_message:"é’‰é’‰ç¾¤é€šçŸ¥,åƒåŸå°åº—App,æ›´æ–°androidç‰ˆæœ¬å®‰è£…åŒ…å•¦!!",dingtalk_at_all:"true"
    # puts "============================ä¸Šä¼ androidæµ‹è¯•ç‰ˆåˆ°FiræˆåŠŸ============================\n"
    # ding_talk_msg_push(
    #     token:"3a01c05738abaaeaf5c5e17d80d4cc5870410387126c5a5e2fbf0095a79977ef", 
    #     text: "########## é’‰é’‰ç¾¤é€šçŸ¥,åƒåŸå°åº—App,æ›´æ–°androidç‰ˆæœ¬å®‰è£…åŒ…å•¦!!
    #           \nåƒåŸå°åº—Appæ›´æ–°androidåŒ…å·²ç»ä¸Šä¼ åˆ°fir,è¯·æ›´æ–°ä¸‹è½½æœ€æ–°ç‰ˆæœ¬Appè¿›è¡Œæµ‹è¯•!
    #           \n##########ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ğŸ˜ ä¸‹è½½åœ°å€:http://d.7short.com/5a1s ##########\n",
    #     at_all: true
    #   )
  end

  desc "Submit a new Beta Build to Crashlytics Beta"
  lane :beta do
    gradle(task: "clean assembleRelease")
    crashlytics
  
    # sh "your_script.sh"
    # You can also use other beta testing services here
  end

  desc "Deploy a new version to the Google Play"
  lane :deploy do
    gradle(task: "clean assembleRelease")
    upload_to_play_store
  end
end
